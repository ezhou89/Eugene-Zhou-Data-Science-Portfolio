---
title: "2023 MAY 19 - Tornadoes in the US"
date: 2023-05-19
output: html_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)

```

------------------------------------------------------------------------

*The goal of this work is to apply my understanding of data towards real world projects using R and the tidyverse. The data used here is from the TidyTuesday project.*

## *Check Out This Week's Data*

```{r Load , message=FALSE}
# load R packages for analysis
library(tidyverse)
library(tidytuesdayR)
```

```{r, message=FALSE}
# Download the weekly data and make available in the tt object.
# Using the last_tuesday function gives us the latest TidyTuesday data from today's date
tues <- last_tuesday("2023-05-19")
tt <- tt_load(tues)
```

```{r, message=FALSE}
# Check out the available data
tt
```

*\
\
This week's data comes from the [Severe Weather Maps, Graphics, and Data Page](https://www.spc.noaa.gov/wcm/#data) of the NOAA's National Weather Service Storm Prediction Center.*

*\
\
The following are the included variables:*

| ***Variable*** | ***Class*** | ***Description***                                                                                                                                                                      |
|-------------|-------------|----------------------------------------------|
| *om*           | *integer*   | *Tornado number. Effectively an ID for this tornado in this year.*                                                                                                                     |
| *yr*           | *integer*   | *Year, 1950-2022.*                                                                                                                                                                     |
| *mo*           | *integer*   | *Month, 1-12.*                                                                                                                                                                         |
| *dy*           | *integer*   | *Day of the month, 1-31.*                                                                                                                                                              |
| *date*         | *date*      | *Date.*                                                                                                                                                                                |
| *time*         | *time*      | *Time.*                                                                                                                                                                                |
| *tz*           | *character* | [*Canonical tz database timezone*](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones)*.*                                                                                    |
| *datetime_utc* | *datetime*  | *Date and time normalized to UTC.*                                                                                                                                                     |
| *st*           | *character* | *Two-letter postal abbreviation for the state (DC = Washington, DC; PR = Puerto Rico; VI = Virgin Islands).*                                                                           |
| *stf*          | *integer*   | *State FIPS (Federal Information Processing Standards) number.*                                                                                                                        |
| *mag*          | *integer*   | *Magnitude on the F scale (EF beginning in 2007). Some of these values are estimated (see fc).*                                                                                        |
| *inj*          | *integer*   | *Number of injuries. When summing for state totals, use sn == 1 (see below).*                                                                                                          |
| *fat*          | *integer*   | *Number of fatalities. When summing for state totals, use sn == 1 (see below).*                                                                                                        |
| *loss*         | *double*    | *Estimated property loss information in dollars. Prior to 1996, values were grouped into ranges. The reported number for such years is the maximum of its range.*                      |
| *slat*         | *double*    | *Starting latitude in decimal degrees.*                                                                                                                                                |
| *slon*         | *double*    | *Starting longitude in decimal degrees.*                                                                                                                                               |
| *elat*         | *double*    | *Ending latitude in decimal degrees.*                                                                                                                                                  |
| *elon*         | *double*    | *Ending longitude in decimal degrees.*                                                                                                                                                 |
| *len*          | *double*    | *Length in miles.*                                                                                                                                                                     |
| *wid*          | *double*    | *Width in yards.*                                                                                                                                                                      |
| *ns*           | *integer*   | *Number of states affected by this tornado. 1, 2, or 3.*                                                                                                                               |
| *sn*           | *integer*   | *State number for this row. 1 means the row contains the entire track information for this state, 0 means there is at least one more entry for this state for this tornado (om + yr).* |
| *f1*           | *integer*   | *FIPS code for the 1st county.*                                                                                                                                                        |
| *f2*           | *integer*   | *FIPS code for the 2nd county.*                                                                                                                                                        |
| *f3*           | *integer*   | *FIPS code for the 3rd county.*                                                                                                                                                        |
| *f4*           | *integer*   | *FIPS code for the 4th county.*                                                                                                                                                        |
| *fc*           | *logical*   | *Was the mag column estimated?*                                                                                                                                                        |

## \* Initial Thoughts and Questions\*

*Based on the variables provided, there are likely a few interesting relationships to explore with regards to recorded tornadoes, including magnitudes, number of states affected, estimated property loss, and number of injuries and fatalities. Furthermore, because climate change is a pressing concern for many, how has the severity of tornadoes changed over the years?*

## \* Data Wrangling and Exploratory Data Analysis\*

*Let's create a series of smaller data frames to explore whether these variables have some sort of relationship that we can further explore*

```{r Extract}
# Extract tornados.csv from tt 
tornados <- tt$tornados
```

```{r Data Frame 1}
# Create a new data frame to explore tornado magnitudes through the years and the monetary damages caused 

df1 <- tornados %>%
  select(yr, mag, loss) 
  
df1 %>% skimr::skim()
```

*\
\
Out of 68,693 rows, there are 27,170 rows where values for loss are missing. Drop these rows from this first data frame.*

```{r DF1 Clean}
df1 <- df1 %>% 
  drop_na()

# Let's also clean up the original tornados df
tornados <- tornados %>%
  drop_na()
```

*\
\
It makes sense that the amount of monetary damage a tornado incurs should increase with increasing magnitude. For this data frame, we can `group_by` and explore the number of tornados that occured at each magnitude, as well as the average damage cost and when a tornado at each magnitude last occurred.*

```{r DF1 EDA}
df1 %>%
  group_by(mag) %>%
  summarise(`No. of Events` = n(), 
            `Mean Loss (USD)` = mean(loss), 
            `Last Occured` = last(yr))
```

*\
\
Let's plot this first data frame by converting the magnitude to a factor, so we can graph the data as a boxplot. Use a log scale for the y-axis and set `notch = TRUE` to show separation between the IQR of each magnitude.*

```{r Plot DF1}

df1 %>%
ggplot(aes(x = as_factor(mag), y = loss, fill = mag)) + 
  geom_boxplot(notch = TRUE) + 
  scale_y_log10() + 
  scale_fill_steps2(low = "red", 
                    mid = "white", 
                    high = "blue", 
                    midpoint = 2) + 
  labs(x = "Magnitude", 
       y = "Property Loss ($, USD)", 
       title = "Property Damage Increases with Tornado Magnitude")

```

```{r, echo=FALSE, include=FALSE}

image <- df1 %>%
ggplot(aes(x = as_factor(mag), y = loss, fill = mag)) + 
  geom_boxplot(notch = TRUE) + 
  scale_y_log10() + 
  scale_fill_steps2(low = "red", 
                    mid = "white", 
                    high = "blue", 
                    midpoint = 2) + 
  labs(x = "Magnitude", 
       y = "Property Loss ($, USD)", 
       title = "Property Damage Increases with Tornado Magnitude")

```

```{r Plot DF2}
df2 <- tornados %>%
    select(mag, ns, loss) 

df2 %>%
    ggplot((aes(x = as_factor(ns), y = loss))) + 
    geom_boxplot(notch = TRUE) + 
    scale_y_log10() + 
    labs(title = "Losses Do NOT Noticeably Increase Beyond Impacting 2 States", 
         x = "# of States Affected by Tornado", 
         y = "Property Loss ($, USD)")
  
```

```{r}
#df3

```

```{r}
#df4

```

```{r}
#df5
```

## 

```{r, echo=FALSE, include=FALSE, message=FALSE}
# Save image
# This will save your most recent plot
image %>% ggsave(
  filename = "Tornados.png",
  device = "png")

```

## *Future Work*

1.  Further explore the price outliers where only 1 state was affected by the tornado.

2.  Map visualization of tornado damage

3.  Predictive model of tornado damage
